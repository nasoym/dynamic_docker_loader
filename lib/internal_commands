#!/usr/bin/env bash

function handle_internal_command() {
  local internal_path="$1"
  if [[ "$internal_path" == "update" ]];then
    echo "update"
    docker_update_all_containers

  elif [[ "$internal_path" == "remove" ]];then
    echo "remove all containers"
    docker_container_id="$(docker ps --all --filter label="dds" --format "{{.ID}}" || true)"
    echo "found docker_container_ids:${docker_container_id}"
    for container_id in $docker_container_id; do
      echo "remove container: ${container_id}"
      docker rm --force ${container_id}
    done

  elif [[ "$internal_path" == "hello" ]];then
    echo "hello hello"

  elif [[ "$internal_path" == "pull" ]];then
    echo "run git pull"
    git pull

  elif [[ "$internal_path" == "env" ]];then
    env

  elif [[ "$internal_path" == "docker_ps" ]];then
    docker ps --all

  elif [[ "$internal_path" == "clearold" ]];then
    echo "remove old containers"
    # sudo lsof -n -iTCP@127.0.0.1:32836 -sTCP:ESTABLISHED
    :

  elif [[ "$internal_path" == "logs" ]];then
    echo "logs"
    log_lines=${query_lines:-"50"}
    if [[ -r ${LOG_FILE} ]]; then
      tail -n${log_lines} ${LOG_FILE}
    fi
  fi
}

